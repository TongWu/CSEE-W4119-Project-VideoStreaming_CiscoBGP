# CSEE4119 Project 2 Stage B Report

<div align = "center"><font size = 5> Tong Wu, tw2906 <div>

## Task - Advertise prefix to other ASes

### Explain what **`next-hop-self`** does and why you have to use it using an example in your own network. Also, explain on which BGP sessions **next-hop-self** is required, why, and why it is not required on other sessions.

The `next-hop-self` is used to configure the router itself as the next hop for a BGP neighbour or peer group. Also, it enables BGP to send itself address in route as the next hop for advertised routes [1]. This command will solve the problem happened in the switch between eBGP and iBGP, since the P2P link between edge router and external router may not advertised in iBGP, which causing the iBGP peers cannot use the BGP advertisement and discard it. In the project configuration, all BGP routes that connects to neighbouring ASes need call `next-hop-self` command, since routers need advertise the next hop for the eBGP route to iBGP routes as themselves (loopback addresses). Other BGP routes that do not need to used in iBGP route, should not use this command, like the BGP route between IXP and NEWY router. 

<div STYLE="page-break-after: always;"></div>

### `show ip bgp` for the router MIAM

![show_ip_bgp_MIAM1](https://images.wu.engineer/images/2022/12/02/show_ip_bgp_MIAM11ef818236e13255f.jpeg)

![show_ip_bgp_MIAM2](https://images.wu.engineer/images/2022/12/02/show_ip_bgp_MIAM2.jpeg)

![show_ip_bgp_MIAM3](https://images.wu.engineer/images/2022/12/02/show_ip_bgp_MIAM3.jpeg)

![show_ip_bgp_MIAM4](https://images.wu.engineer/images/2022/12/02/show_ip_bgp_MIAM4.jpeg)

![show_ip_bgp_MIAM5](https://images.wu.engineer/images/2022/12/02/show_ip_bgp_MIAM5.jpeg)

![show_ip_bgp_MIAM6](https://images.wu.engineer/images/2022/12/02/show_ip_bgp_MIAM6.jpeg)

![show_ip_bgp_MIAM7](https://images.wu.engineer/images/2022/12/02/show_ip_bgp_MIAM7.jpeg)

<div STYLE="page-break-after: always;"></div>

### Result of the Looking Glass for one router located in a neighbouring AS

http://34.171.188.127:2500/50_NEWYrouter.txt

```shell
2022-12-02T19:45:48
BGP table version is 3784, local router ID is 50.155.0.1, vrf id 0
Default local pref 100, local AS 50
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete

   Network          Next Hop            Metric LocPrf Weight Path
* i1.0.0.0/8        50.152.0.1                    100      0 47 45 43 1 i
*>i                 50.151.0.1                    100      0 48 46 43 1 i
*=i                 50.156.0.1                    100      0 48 46 43 1 i
* i2.0.0.0/8        50.152.0.1                    100      0 47 45 43 2 i
*>i                 50.151.0.1                    100      0 48 46 43 2 i
*=i                 50.156.0.1                    100      0 48 46 43 2 i
*> 3.0.0.0/8        180.88.0.29                            0 29 31 30 1 3 i
*> 3.101.0.0/24     180.88.0.29                            0 29 31 30 1 3 i
*> 4.0.0.0/8        180.88.0.29                            0 29 31 30 2 4 i
*> 5.0.0.0/8        180.88.0.29                            0 29 32 15 18 1 3 5 i
*> 7.0.0.0/8        180.88.0.29                            0 29 32 15 18 1 3 5 7 i
*> 8.0.0.0/8        180.88.0.29                            0 29 32 15 18 1 3 5 8 i
*> 9.0.0.0/8        180.88.0.29                            0 29 32 15 18 1 3 5 8 9 i
*> 10.0.0.0/8       180.88.0.29                            0 29 32 15 18 1 3 5 8 10 i
*> 11.0.0.0/8       180.88.0.29                            0 29 32 15 18 1 3 5 8 10 11 i
*> 13.0.0.0/8       180.88.0.29                            0 29 32 15 18 13 i
*> 14.0.0.0/8       180.88.0.29                            0 29 32 15 18 1 3 5 8 10 11 14 i
*> 15.0.0.0/8       180.88.0.29                            0 29 32 15 i
* i16.0.0.0/8       50.152.0.1                    100      0 47 45 43 16 i
*>i                 50.151.0.1                    100      0 48 46 43 16 i
*=i                 50.156.0.1                    100      0 48 46 43 16 i
*> 17.0.0.0/8       180.88.0.29                            0 29 32 15 17 i
*> 18.0.0.0/8       180.88.0.29                            0 29 32 15 18 i
*> 19.0.0.0/8       180.88.0.29                            0 29 32 15 17 19 i
*> 20.0.0.0/8       180.88.0.29                            0 29 32 15 18 20 i
*> 21.0.0.0/8       180.88.0.29                            0 29 32 15 17 19 21 i
*> 22.0.0.0/8       180.88.0.29                            0 29 32 15 18 20 22 i
*> 23.0.0.0/8       180.88.0.29                            0 29 32 15 17 19 22 23 i
*> 24.0.0.0/8       180.88.0.29                            0 29 32 15 17 19 22 24 i
*> 25.0.0.0/8       180.88.0.29                            0 29 32 15 17 19 22 23 25 i
*> 26.0.0.0/8       180.88.0.29                            0 29 32 15 17 19 22 24 26 i
*> 27.0.0.0/8       180.88.0.29                            0 29 32 27 i
* i28.0.0.0/8       50.152.0.1                    100      0 47 45 43 1 3 28 i
*>i                 50.151.0.1                    100      0 48 46 44 1 3 28 i
*=i                 50.156.0.1                    100      0 48 46 44 1 3 28 i
*> 29.0.0.0/8       180.88.0.29              0             0 29 i
*> 30.0.0.0/8       180.88.0.29                            0 29 32 30 i
*> 31.0.0.0/8       180.88.0.29                            0 29 31 i
*> 32.0.0.0/8       180.88.0.29                            0 29 32 i
*> 33.0.0.0/8       180.88.0.29                            0 29 32 33 i
*> 34.0.0.0/8       180.88.0.29                            0 29 32 34 i
*> 35.0.0.0/8       180.88.0.29                            0 29 32 34 35 i
*> 36.0.0.0/8       180.88.0.29                            0 29 32 34 36 i
*> 37.0.0.0/8       180.88.0.29                            0 29 32 34 36 37 i
*> 37.153.0.0/24    180.88.0.29                            0 29 32 34 36 37 i
*> 38.0.0.0/8       180.88.0.29                            0 29 31 33 35 38 i
*> 39.0.0.0/8       180.88.0.29                            0 29 31 33 35 37 39 i
*> 40.0.0.0/8       180.88.0.29                            0 29 31 33 35 37 40 i
*> 41.0.0.0/8       180.88.0.41              0             0 41 i
*> 42.0.0.0/8       180.88.0.29                            0 29 32 15 17 42 i
* i43.0.0.0/8       50.152.0.1                    100      0 47 45 43 i
*>i                 50.151.0.1                    100      0 48 46 43 i
*=i                 50.156.0.1                    100      0 48 46 43 i
* i44.0.0.0/8       50.152.0.1                    100      0 47 45 44 i
*>                  180.88.0.29                            0 29 31 44 i
* i                 50.151.0.1                    100      0 48 46 44 i
* i                 50.156.0.1                    100      0 48 46 44 i
* i45.0.0.0/8       50.152.0.1                    100      0 47 45 i
*                   180.88.0.29                            0 29 31 44 45 i
*=i                 50.156.0.1                    100      0 48 45 i
*>i                 50.151.0.1                    100      0 48 45 i
* i46.0.0.0/8       50.152.0.1                    100      0 47 46 i
*                   180.88.0.29                            0 29 31 44 46 i
*>i                 50.151.0.1                    100      0 48 46 i
*=i                 50.156.0.1                    100      0 48 46 i
*>i47.0.0.0/8       50.152.0.1                    100      0 47 i
*                   180.88.0.29                            0 29 31 44 46 47 i
*  48.0.0.0/8       180.88.0.29                            0 29 31 44 46 48 i
*=i                 50.156.0.1               0    100      0 48 i
*>i                 50.151.0.1               0    100      0 48 i
*  49.0.0.0/8       180.88.0.29                            0 29 31 44 46 47 49 i
*>i                 50.153.0.1               0    100      0 49 i
*>i50.0.0.0/8       50.153.0.1               0    100      0 i
*  51.0.0.0/8       180.88.0.29                            0 29 31 44 46 47 49 51 i
*>i                 50.157.0.1               0    100      0 51 i
*  52.0.0.0/8       180.88.0.29                            0 29 31 44 46 47 49 52 i
* i                 50.154.0.1                    100      0 52 i
*>i                 50.158.0.1                    100      0 52 i
* i53.0.0.0/8       50.154.0.1                    100      0 52 53 i
* i                 50.158.0.1                    100      0 52 53 i
*                   180.88.0.29                            0 29 31 44 45 47 49 51 53 i
*>i                 50.157.0.1                    100      0 51 53 i
*  54.0.0.0/8       180.88.0.29                            0 29 31 44 46 47 49 52 54 i
*>i                 50.158.0.1                    100      0 52 54 i
* i                 50.154.0.1                    100      0 52 54 i
*>i55.0.0.0/8       50.157.0.1                    100      0 51 53 55 i
* i                 50.154.0.1                    100      0 52 54 55 i
* i                 50.158.0.1                    100      0 52 53 55 i
*> 56.0.0.0/8       180.88.0.29                            0 29 31 56 i
* i                 50.158.0.1                    100      0 52 54 56 i
* i                 50.154.0.1                    100      0 52 54 56 i
* i57.0.0.0/8       50.157.0.1                    100      0 51 58 59 57 i
* i                 50.152.0.1                    100      0 47 58 59 57 i
* i                 50.153.0.1                    100      0 49 58 59 57 i
*>i                 50.151.0.1                    100      0 48 46 43 57 i
*=i                 50.156.0.1                    100      0 48 46 43 57 i
*>i58.0.0.0/8       50.157.0.1                    100      0 51 58 i
* i                 50.152.0.1                    100      0 47 58 i
* i                 50.153.0.1                    100      0 49 58 i
*>i59.0.0.0/8       50.157.0.1                    100      0 51 58 59 i
* i                 50.152.0.1                    100      0 47 58 59 i
* i                 50.153.0.1                    100      0 49 58 59 i
*>i60.0.0.0/8       50.157.0.1                    100      0 51 58 60 i
* i                 50.152.0.1                    100      0 47 58 60 i
* i                 50.153.0.1                    100      0 49 58 60 i
*>i61.0.0.0/8       50.157.0.1                    100      0 51 58 59 61 i
* i                 50.152.0.1                    100      0 47 58 59 61 i
* i                 50.153.0.1                    100      0 49 58 59 61 i
*>i62.0.0.0/8       50.157.0.1                    100      0 51 58 59 62 i
* i                 50.152.0.1                    100      0 47 58 59 62 i
* i                 50.153.0.1                    100      0 49 58 59 62 i
*                   180.88.0.29                            0 29 32 30 57 59 62 i
*>i63.0.0.0/8       50.157.0.1                    100      0 51 58 59 61 63 i
* i                 50.152.0.1                    100      0 47 58 59 61 63 i
* i                 50.153.0.1                    100      0 49 58 59 61 63 i
*                   180.88.0.29                            0 29 32 30 57 59 61 63 i
*>i64.0.0.0/8       50.157.0.1                    100      0 51 58 59 61 64 i
* i                 50.152.0.1                    100      0 47 58 59 61 64 i
* i                 50.153.0.1                    100      0 49 58 59 61 64 i
*>i65.0.0.0/8       50.157.0.1                    100      0 51 58 59 61 63 65 i
* i                 50.152.0.1                    100      0 47 58 59 61 63 65 i
* i                 50.153.0.1                    100      0 49 58 59 61 63 65 i
*>i66.0.0.0/8       50.157.0.1                    100      0 51 58 59 61 63 66 i
* i                 50.152.0.1                    100      0 47 58 59 61 63 66 i
* i                 50.153.0.1                    100      0 49 58 59 61 63 66 i
*>i67.0.0.0/8       50.157.0.1                    100      0 51 58 59 61 63 65 67 i
* i                 50.152.0.1                    100      0 47 58 59 61 63 65 67 i
* i                 50.153.0.1                    100      0 49 58 59 61 63 65 67 i
*>i68.0.0.0/8       50.157.0.1                    100      0 51 68 i
* i                 50.152.0.1                    100      0 47 68 i
*                   180.88.0.29                            0 29 31 44 45 68 i
* i                 50.153.0.1                    100      0 49 68 i
*>i69.0.0.0/8       50.157.0.1                    100      0 51 68 69 i
* i                 50.152.0.1                    100      0 47 68 69 i
*                   180.88.0.29                            0 29 31 44 45 68 69 i
* i                 50.153.0.1                    100      0 49 68 69 i
*>i70.0.0.0/8       50.157.0.1                    100      0 51 70 i
* i                 50.152.0.1                    100      0 47 70 i
* i                 50.153.0.1                    100      0 49 70 i
*                   180.88.0.29                            0 29 31 44 45 70 i
* i71.0.0.0/8       50.152.0.1                    100      0 47 45 43 71 i
*>i                 50.151.0.1                    100      0 48 46 43 71 i
*=i                 50.156.0.1                    100      0 48 46 43 71 i
* i72.0.0.0/8       50.157.0.1                    100      0 51 58 59 72 i
* i                 50.152.0.1                    100      0 47 58 59 72 i
* i                 50.153.0.1                    100      0 49 58 59 72 i
*>i                 50.151.0.1                    100      0 48 46 43 72 i
*=i                 50.156.0.1                    100      0 48 46 43 72 i
* i73.0.0.0/8       50.157.0.1                    100      0 51 58 59 72 73 i
* i                 50.152.0.1                    100      0 47 58 59 72 73 i
* i                 50.153.0.1                    100      0 49 58 59 72 73 i
*>i                 50.151.0.1                    100      0 48 46 43 71 73 i
*=i                 50.156.0.1                    100      0 48 46 43 71 73 i
*>i74.0.0.0/8       50.157.0.1                    100      0 51 58 59 74 i
* i                 50.152.0.1                    100      0 47 58 59 74 i
* i                 50.153.0.1                    100      0 49 58 59 74 i
*>i75.0.0.0/8       50.157.0.1                    100      0 51 58 59 74 75 i
* i                 50.152.0.1                    100      0 47 58 59 74 75 i
* i                 50.153.0.1                    100      0 49 58 59 74 75 i
*>i76.0.0.0/8       50.157.0.1                    100      0 51 58 59 76 i
* i                 50.152.0.1                    100      0 47 58 59 76 i
* i                 50.153.0.1                    100      0 49 58 59 76 i
*>i77.0.0.0/8       50.157.0.1                    100      0 51 58 59 76 77 i
* i                 50.152.0.1                    100      0 47 58 59 76 77 i
* i                 50.153.0.1                    100      0 49 58 59 76 77 i
*>i78.0.0.0/8       50.157.0.1                    100      0 51 58 59 78 i
* i                 50.152.0.1                    100      0 47 58 59 78 i
* i                 50.153.0.1                    100      0 49 58 59 78 i
*>i79.0.0.0/8       50.157.0.1                    100      0 51 58 59 78 79 i
* i                 50.152.0.1                    100      0 47 58 59 78 79 i
* i                 50.153.0.1                    100      0 49 58 59 78 79 i
*>i80.0.0.0/8       50.157.0.1                    100      0 51 58 59 80 i
* i                 50.152.0.1                    100      0 47 58 59 80 i
* i                 50.153.0.1                    100      0 49 58 59 80 i
*>i81.0.0.0/8       50.157.0.1                    100      0 51 58 59 80 81 i
* i                 50.152.0.1                    100      0 47 58 59 80 81 i
* i                 50.153.0.1                    100      0 49 58 59 80 81 i
*>i82.0.0.0/8       50.157.0.1                    100      0 51 58 59 82 i
* i                 50.152.0.1                    100      0 47 58 59 82 i
* i                 50.153.0.1                    100      0 49 58 59 82 i
*>i83.0.0.0/8       50.157.0.1                    100      0 51 58 59 82 83 i
* i                 50.152.0.1                    100      0 47 58 59 82 83 i
* i                 50.153.0.1                    100      0 49 58 59 82 83 i
*>i84.0.0.0/8       50.157.0.1                    100      0 51 58 59 84 i
* i                 50.152.0.1                    100      0 47 58 59 84 i
* i                 50.153.0.1                    100      0 49 58 59 84 i
*  100.0.0.0/8      180.88.0.29                            0 29 32 100 i
*>i                 50.153.0.1               0    100      0 100 i
*> 180.0.40.0/24    180.88.0.29                            0 29 31 33 35 37 40 i

Displayed  86 routes and 189 total paths
```

<div STYLE="page-break-after: always;"></div>

### **PARI-host** to the **PARI-host** of one of the neighbouring AS

#### PARI_host(ASN49) -> PARI_host(ASN51)

![49PARIhost_51PARIhost](https://images.wu.engineer/images/2022/12/02/49PARIhost_51PARIhost-1670010520937-3.jpeg)

#### PARI_host(ASN49) -> PARI_host(ASN20)

![49PARIhost_20PARIhost](https://images.wu.engineer/images/2022/12/02/49PARIhost_20PARIhost-1670010527542-5.jpeg)

<div STYLE="page-break-after: always;"></div>

## References

[1] *Neighbor next-hop-self*. (n.d.). Retrieved 2 December 2022, from https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-7858/Content/Chp_BGP/BGP_cmds/nei-nex-hop-sel-10.htm